<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="CORA-GO - Global Outreach Mobile Control">
    <title>CORA-GO</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="assets/icons/icon.svg">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <link rel="stylesheet" href="css/cora-go.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header id="header">
            <div class="header-left">
                <span class="logo">CORA-GO</span>
                <span id="pcStatus" class="status-dot offline" title="PC Status"></span>
            </div>
            <div class="header-right">
                <button id="settingsBtn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- Pairing Banner (shown when not paired) -->
        <div id="pairingBanner" style="display:none; background: linear-gradient(90deg, #ff00ff, #00ffff); padding: 12px 20px; text-align: center;">
            <a href="pair.html" style="color: #000; font-weight: bold; text-decoration: none; font-size: 1.1rem;">
                üì± Tap here to pair with your PC ‚Üí
            </a>
        </div>

        <!-- Tab Content -->
        <main id="tabContent">
            <!-- CHAT TAB -->
            <section id="chatTab" class="tab-panel active">
                <div id="messages"></div>
                <div class="input-area">
                    <div class="input-row">
                        <button id="micBtn" class="icon-btn">üé§</button>
                        <input type="text" id="userInput" placeholder="Message..." autocomplete="off">
                        <button id="sendBtn" class="icon-btn primary">‚ñ∂</button>
                    </div>
                </div>
            </section>

            <!-- PC TAB -->
            <section id="pcTab" class="tab-panel">
                <div class="panel-scroll">
                    <!-- PC Status Card -->
                    <div class="card">
                        <div class="card-header">
                            <span>PC Anchor</span>
                            <button id="retryBtn" class="icon-btn small" onclick="retryConnection()" title="Retry connection">üîÑ</button>
                            <span id="pcOnline" class="badge offline">Offline</span>
                        </div>
                        <div id="pcInfo" class="card-body">
                            <p class="muted">Connect to see PC status</p>
                        </div>
                        <div id="pcError" class="card-body error-info" style="display:none;">
                            <p id="pcErrorMsg" class="error-text"></p>
                            <button class="tool-btn" onclick="retryConnection()">üîÑ Retry Connection</button>
                            <button class="tool-btn" onclick="repairPairing()">üîß Repair Pairing</button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">Quick Actions</div>
                        <div class="card-body">
                            <div class="tool-grid">
                                <button class="tool-btn" onclick="runTool('system_info')">üìä System</button>
                                <button class="tool-btn" onclick="runTool('get_clipboard')">üìã Clipboard</button>
                                <button class="tool-btn" onclick="runTool('list_notes')">üìù Notes</button>
                                <button class="tool-btn" onclick="runTool('check_ollama')">ü§ñ Ollama</button>
                                <button class="tool-btn" onclick="runTool('get_weather')">üå§Ô∏è Weather</button>
                                <button class="tool-btn" onclick="runTool('get_time')">üïê Time</button>
                            </div>
                        </div>
                    </div>

                    <!-- Tool Result -->
                    <div id="toolResult" class="card hidden">
                        <div class="card-header">Result</div>
                        <pre id="toolOutput" class="card-body code"></pre>
                    </div>
                </div>
            </section>

            <!-- BOTS TAB -->
            <section id="botsTab" class="tab-panel">
                <div class="panel-scroll">
                    <!-- Running Bots -->
                    <div class="card">
                        <div class="card-header">
                            <span>Running Bots</span>
                            <button class="icon-btn small" onclick="refreshBots()">üîÑ</button>
                        </div>
                        <div id="runningBots" class="card-body">
                            <p class="muted">Connect to PC to see bots</p>
                        </div>
                    </div>

                    <!-- Available Bots (populated from PC) -->
                    <div class="card">
                        <div class="card-header">Available Bots</div>
                        <div id="availableBots" class="card-body">
                            <p class="muted">Bots will appear here when PC reports them</p>
                        </div>
                    </div>

                    <!-- Send to Bot -->
                    <div class="card">
                        <div class="card-header">Message Bot</div>
                        <div class="card-body">
                            <select id="botSelect" class="full-width">
                                <option value="">Select bot...</option>
                            </select>
                            <div class="input-row" style="margin-top:8px;">
                                <input type="text" id="botMessage" placeholder="Message...">
                                <button class="icon-btn primary" onclick="sendToBot()">‚ñ∂</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Tab Bar -->
        <nav id="tabBar">
            <button class="tab-btn active" data-tab="chatTab">
                <span class="tab-icon">üí¨</span>
                <span class="tab-label">Chat</span>
            </button>
            <button class="tab-btn" data-tab="pcTab">
                <span class="tab-icon">üñ•Ô∏è</span>
                <span class="tab-label">PC</span>
            </button>
            <button class="tab-btn" data-tab="botsTab">
                <span class="tab-icon">ü§ñ</span>
                <span class="tab-label">Bots</span>
            </button>
        </nav>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn" onclick="closeSettings()">√ó</button>
                </div>
                <div class="modal-body">
                    <!-- Pairing Status -->
                    <div class="setting-group">
                        <label>Device Pairing</label>
                        <div id="pairingStatus" style="padding: 10px; background: #1a1a1a; border-radius: 8px; margin-top: 5px;">
                            <span id="pairingStatusText">Not paired</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <button id="pairBtn" onclick="location.href='pair.html'" style="padding: 8px 16px; background: var(--accent); color: #000; border: none; border-radius: 6px; cursor: pointer;">Pair Device</button>
                            <button id="unpairBtn" onclick="unpairDevice()" style="padding: 8px 16px; background: #333; color: #fff; border: none; border-radius: 6px; cursor: pointer; margin-left: 8px; display: none;">Unpair</button>
                        </div>
                    </div>

                    <div class="setting-group" style="margin-top: 1rem;">
                        <label>AI Backend</label>
                        <select id="backendSelect">
                            <option value="pc">Via PC (Ollama)</option>
                            <option value="pollinations">Pollinations (Direct)</option>
                        </select>
                    </div>

                    <div class="setting-group" style="margin-top: 1rem;">
                        <label>Service Configuration</label>
                        <button onclick="location.href='setup.html'" style="padding: 10px 16px; background: linear-gradient(90deg, #ff00ff, #00ffff); color: #000; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; width: 100%;">
                            ‚öôÔ∏è Configure Services (Media, NAS, Cameras...)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DEBUG PANEL -->
    <div id="debugPanel" style="display:none; position:fixed; top:50px; left:10px; right:10px; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.95); color:#0f0; font-family:monospace; font-size:10px; padding:5px; border:2px solid #0f0; border-radius:8px; z-index:9999; user-select:text; -webkit-user-select:text;">
        <button onclick="document.getElementById('debugPanel').style.display='none'" style="position:absolute; top:2px; right:2px; background:#f00; color:#fff; border:none; width:24px; height:24px; border-radius:12px; font-weight:bold; font-size:14px;">X</button>
        <div id="debugLog" style="user-select:text; -webkit-user-select:text; margin-top:20px;"></div>
    </div>
    <script>
        window.debugLog = function(msg) {
            const log = document.getElementById('debugLog');
            if (log) {
                const time = new Date().toLocaleTimeString();
                log.innerHTML += `<div>[${time}] ${msg}</div>`;
                log.scrollTop = log.scrollHeight;
            }
            console.log(msg);
        };
        // Triple-tap logo to show debug panel
        let tapCount = 0;
        document.querySelector('.logo')?.addEventListener('click', () => {
            tapCount++;
            setTimeout(() => tapCount = 0, 500);
            if (tapCount >= 3) {
                document.getElementById('debugPanel').style.display = 'block';
                tapCount = 0;
            }
        });
    </script>

    <script src="js/relay.js"></script>
    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW failed:', err));
        }
    </script>
</body>
</html>
